//This workflow will scan the repository's dependencies, check for vulnerabilities, and update the KBOM schema.

name: Update KBOM  # Defines the name of the GitHub Actions workflow

on:
  push:
    branches:
      - main  # Triggers the workflow when changes are pushed to the main branch

jobs:
  update-kbom:
    runs-on: ubuntu-latest  # Specifies the OS environment to run the job

    steps:
      - name: Checkout code
        uses: actions/checkout@v2  # Checks out the repository's code to the runner

      - name: Install Trivy
        run: |
          curl -sfL https://github.com/aquasecurity/trivy/releases/download/v0.22.0/trivy_0.22.0_Linux-x86_64.tar.gz | tar xz -C /usr/local/bin
        # Downloads and extracts Trivy, a security scanner for vulnerabilities in dependencies

      - name: Scan dependencies and generate KBOM
        run: |
          trivy fs --format json --output kbom.json .
        # Runs Trivy to scan the filesystem for vulnerabilities and outputs the results in JSON format to 'kbom.json'

      - name: Commit and push KBOM update
        run: |
          git add kbom.json
          git commit -m "Update KBOM schema"
          git push
        # Adds the generated KBOM file to Git, commits the changes, and pushes them to the repository
